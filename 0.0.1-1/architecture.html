<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Architecture</title>
    <link rel="stylesheet" href="/css/style.css">
    <script type="application/javascript">
      fetch('../versions.json')
        .then(function(response) {
            if (response.status == 200) {
              response.json().then(function(versions) {
                var select = '<select onchange="if (this.value) window.location.href=this.value">';
                versions.forEach(function(v){
                    select += '<option value="'+v.name+'">'+v.name+'</option>'; 
                });
                select += '</select>';

                var nav = document.querySelector('#nav');
                nav.innerHTML = select;
              });
            } else {
              console.log('ERROR', response);
            }
          }
        ).catch(function(err) {
          console.log('Error', err);
        });
    </script>
  </head>
  <body>
    <nav id="nav"></nav>
    <h1>Architecture</h1>
    <section>
      <h2 id="architecture">Architecture</h2>

<h3 id="supported-regions">Supported Regions</h3>

<p>DRAGEN on Azure is available in regions where FPGA-enabled <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/np-series">Standard NP Family VMs</a> are available.  Supported regions currently include:</p>

<ul>
  <li>West US 2</li>
  <li>East US</li>
  <li>Southeast Asia (Singapore)</li>
  <li>West Europe (Amsterdam)</li>
</ul>

<h3 id="architecture-diagram">Architecture Diagram</h3>

<p><img src="./images/dragen-on-azure.png" alt="architecture-diagram" /></p>

<h3 id="resource-list">Resource List</h3>

<p>List of Azure resources that are deployed by this quickstart if default settings and parameters are used:</p>

<ul>
  <li>Blob Storage account for input and output data
    <ul>
      <li>Note: A new storage account is created by default, although users have the option to specify an existing storage account - see section on additional deployment configurations</li>
    </ul>
  </li>
  <li>Azure Batch account for managing and scheduling DRAGEN jobs</li>
  <li>User Subscription node pool backed by one <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/np-series">NP-series VM</a> (fixed scale)</li>
  <li>Key Vault for batch service auth to User Subscription job pool VMs
    <ul>
      <li>Note: Batch service handles auth automatically, so users do not need to take any further action after the Key Vault is created.</li>
    </ul>
  </li>
</ul>

<h3 id="quota-increases">Quota Increases</h3>

<h4 id="np-series-vms">NP-Series VMs</h4>

<p>DRAGEN runs on FPGA-enabled VMs, which are now generally available as the NP-series on Azure.  In order to enable access to these VM SKUs by Batch service, users will need to contact support to request a quota.  This applies to both user subscription and batch managed job pools.</p>

<p>All users who deploy DRAGEN through Batch service will need to request a quota for the NP-series VM SKU by submitting a support request.  In your Batch account in the Azure portal, go to the “Quotas” tab and use the button labeled “Request quota increase” to start a new request.</p>

<h4 id="batch-accounts">Batch Accounts</h4>

<p>Depending on the user’s workflow, it may also be necessary to request an increase in quota for Batch accounts.  Current default quotas for Batch accounts can be found <a href="https://docs.microsoft.com/en-us/azure/batch/batch-quota-limit#resource-quotas">here</a>.</p>

<p>If you need to increase your Batch account quota, see <a href="https://docs.microsoft.com/en-us/azure/batch/batch-quota-limit#increase-a-quota">this page</a> for more information on creating a support request.</p>

<h3 id="note-on-batch-node-pool-allocation">Note on Batch Node Pool Allocation</h3>

<p>Batch offers two options for allocation of node pools: Batch managed and user subscription modes.</p>

<h4 id="batch-managed-node-pools">Batch Managed Node Pools</h4>

<p>When Batch Managed allocation mode is selected, users must request NP VM quota for each specific Batch instance they create.  Nodes are allocated as needed from Batch-managed subscriptions.  This scenario works best when users intend to persist and use one or very few Batch instances for their DRAGEN jobs.  It is less ideal in situations where the creation/deletion of Batch accounts is automated or occurs frequently, as with CI/CD.</p>

<h4 id="user-subscription-node-pools">User Subscription Node Pools</h4>

<p>When the User Subscription allocation mode is selected, users request an overall quota for NP VMs for a region within their subscription.  With this model, the VMs needed for the Batch account are created directly in the user’s subscription.  This setup is useful for CI/CD and other cases where users are running DRAGEN across many Batch accounts within a subscription and/or the Batch accounts are short-lived.</p>

<h4 id="cost-differences-in-node-pool-allocation-modes">Cost Differences in Node Pool Allocation Modes</h4>

<p>There may be cost differences between the two different node pool allocation methods.  Consider your usage scenarios and consult Azure documentation and pricing calculators to determine which approach will be most optimal for your needs.</p>

<h3 id="azure-costs">Azure Costs</h3>

<p>Users are responsible for costs of any services deployed through this quickstart or its customization options.</p>

<p>Prices are subject to change - more information can be found on the pricing pages for Azure resources deployed through this tutorial:</p>

<ul>
  <li><a href="https://azure.microsoft.com/en-us/pricing/details/storage/blobs/">Azure Blob Storage</a></li>
  <li><a href="https://azure.microsoft.com/en-us/pricing/details/batch/windows-virtual-machines/">Azure Batch</a>
    <ul>
      <li><em>Note: There is currently no charge for Batch itself, only the compute resources it uses; see VM pricing below</em></li>
    </ul>
  </li>
  <li><a href="https://azure.microsoft.com/en-us/pricing/details/virtual-machines/linux/#np-series">NP-series VMs</a> (a NP10s is used in this reference deployment)</li>
  <li><a href="https://azure.microsoft.com/en-us/pricing/details/key-vault/#pricing">Key Vault</a></li>
</ul>

<p>Users are also responsible for costs of any licenses needed to run DRAGEN (not included in this quickstart - must be obtained separately).</p>

<h4 id="estimate-your-costs">Estimate your Costs</h4>

<p>For help in estimating your costs to run DRAGEN on Azure, see the pricing calculator located <a href="https://azure.microsoft.com/en-us/pricing/calculator/">here</a>.</p>

    </section>
    <footer></footer>
  </body>
</html>